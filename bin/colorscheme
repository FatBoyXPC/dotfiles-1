#/usr/bin/env bash

function get_termite_font_size {
  grep "font = " ~/.config/termite/config | grep -Eo "[0-9]+$"
}

function set_termite_colorscheme_file {
  colorscheme_file=$1
  ~/.config/termite/config.template.sh "$colorscheme_file" `get_termite_font_size`
}

function reload_termite_config() {
  # Termite reloads its config on SIGUSR1.
  # https://github.com/thestinger/termite/blob/3bc2a43bef9b0842cb242dd19853d0344c8a2766/termite.cc#L1715

  kill -s USR1 `xdotool getwindowpid $(xdotool getwindowfocus)`
}

function dark() {
  set_termite_colorscheme_file "solarized-dark"
  reload_termite_config
}

function light() {
  set_termite_colorscheme_file "solarized-light"
  reload_termite_config
  set_termite_colorscheme_file "solarized-dark"
}

allowed_commands="dark light"
# From http://stackoverflow.com/a/8064551
listcontains() {
  for word in $1; do
    [[ $word = $2 ]] && return 0
  done
  return 1
}

# Validate command line arguments
print_usage_and_exit() {
  echo -n "Usage: $0 "
  for command in $allowed_commands; do
    echo -n "[$command] "
  done
  echo
  exit
}
if [ $# -lt 1 ]; then
  print_usage_and_exit
fi
for command in "$@"; do
  if ! listcontains "$allowed_commands" $command; then
    echo "Unrecognized command: $command"
    print_usage_and_exit
  fi
done

# Comands have been validated, so execute them!
# Show commands before running them.
set -ex
for command in "$@"; do
  $command
done
